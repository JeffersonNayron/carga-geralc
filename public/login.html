<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Turma C</title>
<link rel="shortcut icon" href="img/vale.png" type="image/x-icon">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    height: 100vh;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #ffffff, #c0305e);
  }
  .card {
    width: 360px;
    padding: 30px 25px;
    border-radius: 15px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    text-align: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.3);
  }
  h3 { display: flex; justify-content: center; align-items: center; gap: 8px; margin-bottom: 25px; color: #00737a; font-weight: 700; }
  h5 { font-weight: 600; color: #00737a; }
  .form-control, .form-select {
    border-radius: 10px; border: 1px solid #00747a8a; padding: 10px; font-size: 0.9rem; text-align: center;
  }
  .form-control:focus, .form-select:focus {
    outline: none; border-color: #00737a; box-shadow: 0 0 5px #00737a;
  }
  .btn-primary, .btn-success { background-color: #00737a; border: none; border-radius: 10px; font-weight: bold; transition: background 0.3s ease; }
  .btn-primary:hover, .btn-success:hover { background-color: #00747aa3; }
  .btn-link { color: #c0305e; font-size: 0.85rem; text-decoration: none; }
  .btn-link:hover { text-decoration: underline; }
  #erro, #resetErro, #resetSucesso { font-size: 0.85rem; text-align: center; margin-top: 8px; }
  .toggle-senha { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #00737a; }
  .position-relative { position: relative; }
  @media(max-width: 400px){
    .card { width: 90%; padding: 25px 20px; }
    h3 { font-size: 1.3rem; }
    .form-control, .form-select, .btn { font-size: 0.85rem; padding: 8px; }
  }
</style>
</head>
<body>
<div class="card">
  <h3><img src="img/vale.png" style="width: 50px;" alt="logo vale">Carga geral - C</h3>

  <!-- Login -->
  <div id="loginForm">
    <select id="perfil" class="form-select mb-3" aria-label="Perfil">
      <option value="inspetoria">Inspetoria</option>
      <option value="ccp">CCP</option>
    </select>
    <div class="position-relative mb-3">
      <input type="password" id="senha" class="form-control" placeholder="Senha">
      <span class="toggle-senha" onclick="toggleSenha('senha')">ðŸ”“</span>
    </div>
    <button id="btnLogin" class="btn btn-primary w-100 mb-2">Entrar</button>
    <button id="btnEsqueceu" class="btn btn-link w-100">Esqueceu a senha?</button>
    <div id="erro" class="text-danger"></div>
  </div>

  <!-- Redefinir Senha -->
  <div id="resetForm" class="d-none">
    <h5 class="mb-3">Redefinir Senha</h5>
    <select id="resetPerfil" class="form-select mb-2" aria-label="Perfil">
      <option value="">Selecione o perfil</option>
      <option value="inspetoria">Inspetoria</option>
      <option value="ccp">CCP</option>
    </select>
    <input type="text" id="resetToken" class="form-control mb-2" placeholder="Token de seguranÃ§a">
    <div class="position-relative mb-2">
      <input type="password" id="novaSenha" class="form-control" placeholder="Nova senha">
      <span class="toggle-senha" onclick="toggleSenha('novaSenha')">ðŸ”“</span>
    </div>
    <button id="btnReset" class="btn btn-success w-100 mb-2">Salvar nova senha</button>
    <button id="btnVoltar" class="btn btn-link w-100">Voltar ao login</button>
    <div id="resetErro" class="text-danger"></div>
    <div id="resetSucesso" class="text-success"></div>
  </div>
</div>

<script>
function toggleSenha(id){
  const input = document.getElementById(id);
  input.type = input.type==='password'?'text':'password';
}

// Login
document.getElementById('btnLogin').addEventListener('click', async ()=>{
  document.getElementById('erro').innerText='';
  const perfil = document.getElementById('perfil').value;
  const senha = document.getElementById('senha').value;
  if(!senha){ document.getElementById('erro').innerText='Informe a senha'; return; }
  try{
    const res = await fetch('/login',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      credentials:'include',
      body:JSON.stringify({perfil, senha})
    });
    const data = await res.json();
    if(data.success){ window.location.href='/index.html'; }
    else{ document.getElementById('erro').innerText = data.error || 'Login falhou'; }
  }catch(e){
    document.getElementById('erro').innerText='Erro de conexÃ£o';
    console.error(e);
  }
});

// Mostrar formulÃ¡rio reset
document.getElementById('btnEsqueceu').addEventListener('click', ()=>{
  document.getElementById('loginForm').classList.add('d-none');
  document.getElementById('resetForm').classList.remove('d-none');
  document.getElementById('resetErro').innerText='';
  document.getElementById('resetSucesso').innerText='';
});

// Voltar ao login
document.getElementById('btnVoltar').addEventListener('click', ()=>{
  document.getElementById('resetForm').classList.add('d-none');
  document.getElementById('loginForm').classList.remove('d-none');
});

// Resetar senha
document.getElementById('btnReset').addEventListener('click', async ()=>{
  document.getElementById('resetErro').innerText='';
  document.getElementById('resetSucesso').innerText='';

  const perfil = document.getElementById('resetPerfil').value.trim();
  const token = document.getElementById('resetToken').value.trim();
  const novaSenha = document.getElementById('novaSenha').value;

  if(!perfil || !token || !novaSenha){
    document.getElementById('resetErro').innerText='Preencha todos os campos'; return;
  }

  try{
    const res = await fetch('/reset-senha',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      credentials:'include',
      body:JSON.stringify({perfil, token, novaSenha})
    });
    const data = await res.json();
    if(data.success){
      document.getElementById('resetSucesso').innerText=data.message || 'Senha alterada';
      setTimeout(()=>{
        document.getElementById('resetForm').classList.add('d-none');
        document.getElementById('loginForm').classList.remove('d-none');
        document.getElementById('senha').value='';
      },1200);
    } else {
      document.getElementById('resetErro').innerText=data.error || 'Erro ao redefinir';
    }
  }catch(e){
    document.getElementById('resetErro').innerText='Erro de conexÃ£o';
    console.error(e);
  }
});
</script>
</body>
</html>
